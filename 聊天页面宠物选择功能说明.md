# 聊天页面宠物选择功能说明

## 📋 功能概述

在聊天页面中添加了宠物选择功能，用户可以选择不同的AI宠物伙伴进行对话，每个宠物都有独特的性格和交流风格。

---

## 🎨 UI 界面

### 宠物选择器位置
- 位于聊天输入框的上方
- 包含4个选项按钮，横向排列

### 宠物选项

| 宠物 | 图标 | 名称 | 描述 | 特点 |
|------|------|------|------|------|
| 🦊 | 狐狸 | 灵灵 | 机敏俏皮 | 聪明应对、认知重构 |
| 🐕 | 狗狗 | 小默 | 温暖陪伴 | 无条件接纳、情感支持 |
| 🐍 | 蛇 | 静 | 冷静哲思 | 抽离观察、禅定智慧 |
| 🤖 | 默认 | AI助手 | 标准模式 | 传统AI助手 |

### 交互效果
- ✨ **悬停效果**: 按钮上移，显示阴影
- 🎯 **选中状态**: 蓝色边框 + 浅蓝色背景
- 📝 **动态提示**: 根据选择的宠物更新输入框提示文本

---

## 💻 技术实现

### 前端修改 (`chat.html`)

#### 1. HTML 结构
```html
<!-- 宠物选择器 -->
<div id="pet-selector">
    <button class="pet-btn" data-pet="fox">
        🦊 灵灵（狐狸） - 机敏俏皮
    </button>
    <button class="pet-btn" data-pet="dog">
        🐕 小默（狗狗） - 温暖陪伴
    </button>
    <button class="pet-btn" data-pet="snake">
        🐍 静（蛇蛇） - 冷静哲思
    </button>
    <button class="pet-btn active" data-pet="none">
        🤖 默认助手 - 标准模式
    </button>
</div>
```

#### 2. CSS 样式
- `.pet-btn:hover`: 悬停效果
- `.pet-btn.active`: 选中状态样式
- 响应式布局，自适应容器宽度

#### 3. JavaScript 功能

**宠物选择逻辑**
```javascript
// 当前选择的宠物类型
let selectedPetType = 'none';

// 宠物按钮点击事件
petButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        // 更新选中状态
        selectedPetType = btn.dataset.pet;
        // 更新UI样式
        // 更新输入框提示文本
    });
});
```

**发送消息包含宠物类型**
```javascript
const requestBody = {
    message: message,
    session_id: sessionId
};

// 添加宠物类型参数
if (selectedPetType !== 'none') {
    requestBody.pet_type = selectedPetType;
}
```

**动态头像显示**
```javascript
const petAvatars = {
    'fox': { emoji: '🦊', name: '灵灵（狐狸）', color: '#ff6b35' },
    'dog': { emoji: '🐕', name: '小默（狗狗）', color: '#f7931e' },
    'snake': { emoji: '🐍', name: '静（蛇）', color: '#4ecdc4' },
    'none': { emoji: '🤖', name: 'AI助手', color: '#2ecc71' }
};
```

### 后端修改 (`views.py`)

#### `send_message` 视图函数
```python
# 获取宠物类型参数
pet_type = data.get('pet_type')

# 传递给LLM服务
ai_response = llm_service.chat(user_message, session_id, pet_type=pet_type)
```

---

## 🔄 完整的数据流

```
用户界面
    ↓
1. 用户选择宠物类型 (fox/dog/snake/none)
    ↓
2. JavaScript保存选择到 selectedPetType 变量
    ↓
3. 用户输入消息并发送
    ↓
4. JavaScript构建请求体，包含 pet_type
    ↓
5. POST请求发送到 /llm/send_message/
    ↓
6. Django视图接收 pet_type 参数
    ↓
7. 调用 llm_service.chat(message, session_id, pet_type)
    ↓
8. LangChainLLMService 根据 pet_type 生成系统提示词
    ↓
9. 调用LLM获取回复
    ↓
10. 返回JSON响应
    ↓
11. JavaScript显示消息，使用对应宠物头像
```

---

## 🎯 用户体验优化

### 1. 视觉反馈
- **按钮状态**: 清晰的选中/未选中状态
- **头像颜色**: 每个宠物独特的配色方案
- **动画效果**: 平滑的悬停和点击动画

### 2. 交互提示
- **输入框提示文本**: 根据宠物类型动态变化
  - 狐狸: "和聪明的小狐狸灵灵聊聊..."
  - 狗狗: "和温暖的小狗小默说说话..."
  - 蛇: "和冷静的小蛇静交流..."
  - 默认: "输入您的消息..."

### 3. 消息展示
- **头像图标**: AI消息显示对应宠物emoji
- **名称标识**: 显示宠物名称（如"灵灵（狐狸）"）
- **颜色区分**: 不同宠物使用不同的头像背景色

---

## 📱 响应式设计

- ✅ 桌面端：4个按钮横向并排
- ✅ 平板端：按钮自适应缩小
- ✅ 移动端：按钮堆叠或缩小字体（可进一步优化）

---

## 🔧 扩展性

### 添加新宠物类型

1. **前端 HTML**: 添加新的宠物按钮
```html
<button class="pet-btn" data-pet="cat">
    🐱 新宠物名称
</button>
```

2. **前端 JavaScript**: 更新配置对象
```javascript
// 更新提示文本
const placeholders = {
    'cat': '和新宠物聊天...',
    // ...
};

// 更新头像信息
const petAvatars = {
    'cat': { emoji: '🐱', name: '新宠物', color: '#颜色代码' },
    // ...
};
```

3. **后端 services.py**: 添加新的系统提示词
```python
def _get_system_prompt(self, pet_type=None):
    if pet_type == 'cat':
        return """新宠物的系统提示词..."""
    # ...
```

---

## ✨ 功能特点

### 优势
1. **无缝集成**: 与现有聊天功能完美结合
2. **实时切换**: 可随时更换宠物类型
3. **视觉清晰**: 直观的UI设计
4. **性能优化**: 仅在需要时传递参数
5. **向后兼容**: 不影响现有功能

### 用户价值
- 🎭 **多样化体验**: 不同性格的AI伙伴
- 💝 **情感连接**: 更具亲和力的交互
- 🎯 **场景适配**: 根据需求选择合适的宠物
- 🌟 **趣味性**: 提升使用乐趣

---

## 🐛 已知问题与改进

### 当前限制
- ❌ 历史消息不显示宠物类型（因为没有存储）
- ❌ 刷新页面后宠物选择会重置
- ❌ 移动端按钮可能需要优化布局

### 未来改进方向
1. **持久化选择**: 将宠物选择保存到localStorage
2. **消息存储**: 在ChatMessage模型中添加pet_type字段
3. **历史显示**: 历史消息显示对应的宠物头像
4. **移动优化**: 响应式布局优化
5. **性能提升**: 考虑缓存系统提示词

---

## 📚 相关文件

- ✅ `llm_service/templates/llm_service/chat.html` - 聊天界面HTML
- ✅ `llm_service/views.py` - Django视图函数
- ✅ `llm_service/services.py` - LLM服务核心逻辑
- ✅ `llm_service/serializers.py` - API序列化器（REST API使用）
- ✅ `llm_service/api_views.py` - REST API视图（REST API使用）

---

## 🎉 总结

成功在聊天页面添加了宠物选择功能，用户现在可以：
- 选择4种不同的AI宠物伙伴
- 看到对应宠物的头像和名称
- 获得个性化的AI回复体验
- 享受更有趣的聊天互动

功能已完全集成，可立即使用！🚀
