# 🐾 宠物类型聊天功能说明

## 📌 功能概述

在 `/api/llm/chat/` 接口中新增了 `pet_type` 参数，支持三种宠物类型：
- **🦊 狐狸 (fox)**: 聪明机灵、活泼可爱
- **🐕 狗 (dog)**: 热情友好、充满活力
- **🐍 蛇 (snake)**: 冷静神秘、充满智慧

AI 将根据选择的宠物类型，以不同的性格和语气回答问题。

---

## 🔧 API 接口说明

### 接口地址
```
POST /api/llm/chat/
```

### 请求头
```
Authorization: Bearer <access_token>
Content-Type: application/json
```

### 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| message | string | ✅ 是 | 用户消息内容 | "你好，介绍一下 Django" |
| session_id | string | ❌ 否 | 会话ID，不传则为 "default" | "session_001" |
| pet_type | string | ❌ 否 | 宠物类型，可选值: fox/dog/snake | "fox" |

### 请求示例

#### 1. 不指定宠物类型（默认模式）
```json
{
  "message": "Django 是什么？"
}
```

#### 2. 狐狸模式 🦊
```json
{
  "message": "Django 是什么？",
  "pet_type": "fox"
}
```

#### 3. 狗狗模式 🐕
```json
{
  "message": "Django 是什么？",
  "pet_type": "dog"
}
```

#### 4. 蛇蛇模式 🐍
```json
{
  "message": "Django 是什么？",
  "pet_type": "snake"
}
```

### 响应格式

```json
{
  "status": "success",
  "message": "消息发送成功",
  "data": {
    "user_message": "Django 是什么？",
    "ai_response": "嘤嘤～让我这只小狐狸来告诉你吧...",
    "session_id": "default",
    "pet_type": "fox",
    "created_at": "2025-10-23T09:55:00Z"
  }
}
```

---

## 🎭 宠物性格设定

### 🦊 狐狸 (fox)
**性格特点**:
- 聪明伶俐，充满好奇心
- 说话时喜欢用"嘤嘤"、"呜呜"等可爱的语气词
- 机智敏捷，善于观察和思考
- 偶尔会调皮捣蛋，但很有分寸
- 喜欢用生动的比喻来解释问题

**回复风格**: 可爱活泼、机智幽默

---

### 🐕 狗 (dog)
**性格特点**:
- 热情开朗，充满活力
- 说话时喜欢用"汪汪"、"嗷呜"等语气词
- 对主人绝对忠诚，乐于助人
- 性格单纯直接，真诚热心
- 总是精力充沛，充满正能量

**回复风格**: 热情友好、正能量满满

---

### 🐍 蛇 (snake)
**性格特点**:
- 冷静沉着，深思熟虑
- 说话时喜欢用"嘶嘶"、"呼呼"等语气词
- 神秘优雅，充满智慧
- 语言简洁精炼，一针见血
- 善于洞察事物本质

**回复风格**: 冷静神秘、睿智深刻

---

## 💻 使用示例

### Python 示例

```python
import requests

# API 配置
API_URL = "http://127.0.0.1:8000/api/llm/chat/"
ACCESS_TOKEN = "your_access_token_here"

headers = {
    "Authorization": f"Bearer {ACCESS_TOKEN}",
    "Content-Type": "application/json"
}

# 狐狸模式
data = {
    "message": "你好，介绍一下 Django",
    "pet_type": "fox",
    "session_id": "my_session"
}

response = requests.post(API_URL, json=data, headers=headers)
print(response.json())
```

### JavaScript/Fetch 示例

```javascript
const API_URL = 'http://127.0.0.1:8000/api/llm/chat/';
const ACCESS_TOKEN = 'your_access_token_here';

fetch(API_URL, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${ACCESS_TOKEN}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    message: '你好，介绍一下 Django',
    pet_type: 'dog',
    session_id: 'my_session'
  })
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));
```

### cURL 示例

```bash
curl -X POST http://127.0.0.1:8000/api/llm/chat/ \
  -H "Authorization: Bearer your_access_token_here" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "你好，介绍一下 Django",
    "pet_type": "snake",
    "session_id": "my_session"
  }'
```

---

## 🧪 测试方法

### 1. 在 Swagger 文档中测试

访问 http://127.0.0.1:8000/api/docs/

1. 点击 `/api/llm/chat/` 接口
2. 点击 "Try it out"
3. 点击 🔒 按钮，输入 Token 进行认证
4. 填写请求参数，包括 `pet_type`
5. 点击 "Execute" 查看响应

### 2. 使用 Postman 测试

1. 创建 POST 请求：`http://127.0.0.1:8000/api/llm/chat/`
2. 在 Headers 中添加：
   - `Authorization`: `Bearer <token>`
   - `Content-Type`: `application/json`
3. 在 Body 中选择 raw (JSON) 并输入请求数据
4. 发送请求查看响应

---

## 📝 注意事项

1. **认证要求**: 必须先登录并获取有效的 JWT Token
2. **宠物类型**: `pet_type` 参数可选，不传则使用默认提示词
3. **有效值**: `pet_type` 只接受 `fox`、`dog`、`snake` 三个值
4. **无效值处理**: 传入无效的 `pet_type` 会返回验证错误
5. **会话管理**: 同一 `session_id` 内的对话会保持上下文连贯性
6. **LLM 配置**: 需要在管理后台配置有效的 LLM API 密钥才能获得真实回复

---

## 🔄 代码修改说明

### 修改的文件

1. **`llm_service/serializers.py`**
   - 在 `ChatRequestSerializer` 中添加 `pet_type` 字段

2. **`llm_service/api_views.py`**
   - 修改 `chat` 方法，接收 `pet_type` 参数并传递给服务层

3. **`llm_service/services.py`**
   - 修改 `SimpleLLMService.chat()` 方法，添加 `pet_type` 参数
   - 修改 `SimpleLLMService._get_llm_response()` 方法签名
   - 修改 `LangChainLLMService._get_llm_response()` 方法，根据宠物类型动态生成系统提示词
   - 新增 `_get_system_prompt()` 方法，根据宠物类型返回不同的提示词

---

## 🎉 功能优势

1. **个性化体验**: 用户可以选择喜欢的宠物类型进行交互
2. **趣味性增强**: 不同的宠物性格让对话更有趣
3. **灵活可扩展**: 可以轻松添加更多宠物类型
4. **向后兼容**: 不传 `pet_type` 参数时使用默认模式，不影响现有功能

---

## 🚀 未来扩展

可以考虑添加更多宠物类型：
- 🐱 猫 (cat): 高冷优雅
- 🐰 兔子 (rabbit): 温柔胆小
- 🐻 熊 (bear): 憨厚可爱
- 🦅 鹰 (eagle): 目光锐利、高瞻远瞩

只需在 `_get_system_prompt()` 方法中添加对应的提示词即可！
