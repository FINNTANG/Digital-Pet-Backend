# ç”¨æˆ·æ¨¡å—ï¼ˆç™»å½•ã€æ³¨å†Œï¼‰æ¥å£ä¸ç®¡ç†ç•Œé¢å¼€å‘æ–¹æ¡ˆ

## ğŸ“Š é¡¹ç›®ç°çŠ¶åˆ†æ

### å·²å®ç°åŠŸèƒ½ï¼ˆReviewï¼‰

#### 1. è§†å›¾å±‚ï¼ˆviews.pyï¼‰
ç°æœ‰è§†å›¾é‡‡ç”¨**ä¼ ç»Ÿçš„Djangoæ¨¡æ¿è§†å›¾**æ–¹å¼ï¼š

```python
âœ… register_view()    # ç”¨æˆ·æ³¨å†Œï¼ˆè¿”å›HTMLé¡µé¢ï¼‰
âœ… login_view()       # ç”¨æˆ·ç™»å½•ï¼ˆè¿”å›HTMLé¡µé¢ï¼‰
âœ… logout_view()      # ç”¨æˆ·ç™»å‡ºï¼ˆé‡å®šå‘ï¼‰
âœ… profile_view()     # ä¸ªäººä¸­å¿ƒï¼ˆè¿”å›HTMLé¡µé¢ï¼‰
âœ… home_view()        # é¦–é¡µï¼ˆè¿”å›HTMLé¡µé¢ï¼‰
```

**ä¼˜ç‚¹**ï¼š
- ä»£ç ç®€æ´ï¼Œæ˜“äºç†è§£
- é€‚åˆä¼ ç»ŸWebåº”ç”¨
- Djangoå†…ç½®åŠŸèƒ½å®Œæ•´

**å±€é™æ€§**ï¼š
- æ— æ³•æä¾›REST APIæ¥å£
- å‰åç«¯è€¦åˆ
- ä¸æ”¯æŒç§»åŠ¨ç«¯ã€ç¬¬ä¸‰æ–¹åº”ç”¨è°ƒç”¨

#### 2. è¡¨å•å±‚ï¼ˆforms.pyï¼‰
```python
âœ… UserRegisterForm   # æ³¨å†Œè¡¨å•ï¼ˆç»§æ‰¿UserCreationFormï¼‰
âœ… UserLoginForm      # ç™»å½•è¡¨å•ï¼ˆç®€å•Formï¼‰
```

**ä¼˜ç‚¹**ï¼š
- è‡ªåŠ¨éªŒè¯ï¼ˆé‚®ç®±é‡å¤ã€å¯†ç å¼ºåº¦ï¼‰
- ä¸­æ–‡æ ‡ç­¾å’Œæç¤º

**å¯æ”¹è¿›**ï¼š
- ç¼ºå°‘æ‰‹æœºå·éªŒè¯
- ç¼ºå°‘éªŒè¯ç åŠŸèƒ½
- ç¼ºå°‘æ‰¾å›å¯†ç åŠŸèƒ½

#### 3. URLè·¯ç”±ï¼ˆurls.pyï¼‰
```python
âœ… /accounts/register/   # æ³¨å†Œé¡µé¢
âœ… /accounts/login/      # ç™»å½•é¡µé¢
âœ… /accounts/logout/     # ç™»å‡º
âœ… /accounts/profile/    # ä¸ªäººä¸­å¿ƒ
```

**ç¼ºå°‘çš„è·¯ç”±**ï¼š
- å¯†ç é‡ç½®
- é‚®ç®±éªŒè¯
- ç”¨æˆ·åˆ—è¡¨ï¼ˆç®¡ç†åŠŸèƒ½ï¼‰
- ç”¨æˆ·è¯¦æƒ…API

## ğŸ¯ å¼€å‘ç›®æ ‡

### ç›®æ ‡1ï¼šæ·»åŠ REST APIæ¥å£
æä¾›æ ‡å‡†çš„RESTful APIï¼Œæ”¯æŒï¼š
- å‰åç«¯åˆ†ç¦»æ¶æ„
- ç§»åŠ¨ç«¯åº”ç”¨æ¥å…¥
- ç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆ
- å¾®æœåŠ¡è°ƒç”¨

### ç›®æ ‡2ï¼šå¢å¼ºç®¡ç†ç•Œé¢
æ”¹è¿›Django Adminç®¡ç†åå°ï¼š
- ç”¨æˆ·åˆ—è¡¨ä¼˜åŒ–
- æ‰¹é‡æ“ä½œ
- æ•°æ®å¯¼å‡º
- æƒé™ç»†ç²’åº¦æ§åˆ¶

### ç›®æ ‡3ï¼šæ‰©å±•ç”¨æˆ·åŠŸèƒ½
- æ‰‹æœºå·æ³¨å†Œ/ç™»å½•
- é‚®ç®±éªŒè¯
- å¯†ç æ‰¾å›
- ç¬¬ä¸‰æ–¹ç™»å½•ï¼ˆå¯é€‰ï¼‰
- ç”¨æˆ·å¤´åƒ
- ä¸ªäººèµ„æ–™ç¼–è¾‘

## ğŸ“‹ æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆAï¼šDjango REST Frameworkï¼ˆæ¨èï¼‰

**æŠ€æœ¯æ ˆ**ï¼š
- Django REST Framework (DRF)
- Simple JWTï¼ˆTokenè®¤è¯ï¼‰
- django-filterï¼ˆè¿‡æ»¤ï¼‰
- drf-yasgï¼ˆAPIæ–‡æ¡£ï¼‰

**ä¼˜åŠ¿**ï¼š
- ä¸šç•Œæ ‡å‡†ï¼Œç”Ÿæ€å®Œå–„
- è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£
- çµæ´»çš„è®¤è¯æ–¹å¼
- åºåˆ—åŒ–å™¨å¼ºå¤§

### æ–¹æ¡ˆBï¼šä¼ ç»ŸDjango + AJAX

**æŠ€æœ¯æ ˆ**ï¼š
- Django CBVï¼ˆç±»è§†å›¾ï¼‰
- JsonResponse
- Sessionè®¤è¯

**ä¼˜åŠ¿**ï¼š
- æ— éœ€é¢å¤–ä¾èµ–
- å­¦ä¹ æˆæœ¬ä½
- é€‚åˆå°å‹é¡¹ç›®

### âœ… æ¨èé‡‡ç”¨æ–¹æ¡ˆA

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‰ç«¯ï¼ˆWeb/Mobile/APIï¼‰           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          APIå±‚ï¼ˆREST APIï¼‰               â”‚
â”‚  - Serializersï¼ˆåºåˆ—åŒ–å™¨ï¼‰               â”‚
â”‚  - ViewSetsï¼ˆè§†å›¾é›†ï¼‰                    â”‚
â”‚  - Permissionsï¼ˆæƒé™æ§åˆ¶ï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆServicesï¼‰            â”‚
â”‚  - ç”¨æˆ·æ³¨å†Œé€»è¾‘                          â”‚
â”‚  - é‚®ç®±éªŒè¯é€»è¾‘                          â”‚
â”‚  - å¯†ç é‡ç½®é€»è¾‘                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ•°æ®å±‚ï¼ˆModelsï¼‰                 â”‚
â”‚  - Userï¼ˆDjangoå†…ç½®ï¼‰                    â”‚
â”‚  - UserProfileï¼ˆæ‰©å±•ï¼‰                   â”‚
â”‚  - EmailVerificationï¼ˆé‚®ç®±éªŒè¯ï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ•°æ®æ¨¡å‹è®¾è®¡

#### æ‰©å±•ç”¨æˆ·æ¨¡å‹

```python
# accounts/models.py

class UserProfile(models.Model):
    """ç”¨æˆ·æ‰©å±•ä¿¡æ¯"""
    user = models.OneToOneField(User, on_delete=models.CASCADE)
    phone = models.CharField(max_length=11, blank=True)  # æ‰‹æœºå·
    avatar = models.ImageField(upload_to='avatars/', blank=True)  # å¤´åƒ
    bio = models.TextField(blank=True)  # ä¸ªäººç®€ä»‹
    birth_date = models.DateField(null=True, blank=True)  # ç”Ÿæ—¥
    gender = models.CharField(max_length=10, choices=[
        ('M', 'ç”·'), ('F', 'å¥³'), ('O', 'å…¶ä»–')
    ], blank=True)
    
    # éªŒè¯çŠ¶æ€
    email_verified = models.BooleanField(default=False)
    phone_verified = models.BooleanField(default=False)
    
    # ç»Ÿè®¡ä¿¡æ¯
    login_count = models.IntegerField(default=0)
    last_login_ip = models.GenericIPAddressField(null=True, blank=True)
    
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)


class EmailVerification(models.Model):
    """é‚®ç®±éªŒè¯ä»¤ç‰Œ"""
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    token = models.CharField(max_length=100, unique=True)
    created_at = models.DateTimeField(auto_now_add=True)
    expires_at = models.DateTimeField()
    is_used = models.BooleanField(default=False)


class PasswordResetToken(models.Model):
    """å¯†ç é‡ç½®ä»¤ç‰Œ"""
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    token = models.CharField(max_length=100, unique=True)
    created_at = models.DateTimeField(auto_now_add=True)
    expires_at = models.DateTimeField()
    is_used = models.BooleanField(default=False)
```

## ğŸ”Œ APIæ¥å£è®¾è®¡

### APIç«¯ç‚¹è§„åˆ’

#### è®¤è¯ç›¸å…³

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | è®¤è¯ |
|------|------|------|------|
| POST | `/api/auth/register/` | ç”¨æˆ·æ³¨å†Œ | å¦ |
| POST | `/api/auth/login/` | ç”¨æˆ·ç™»å½• | å¦ |
| POST | `/api/auth/logout/` | ç”¨æˆ·ç™»å‡º | æ˜¯ |
| POST | `/api/auth/refresh/` | åˆ·æ–°Token | å¦ |
| POST | `/api/auth/verify-email/` | éªŒè¯é‚®ç®± | å¦ |
| POST | `/api/auth/resend-verification/` | é‡å‘éªŒè¯é‚®ä»¶ | æ˜¯ |

#### å¯†ç ç®¡ç†

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | è®¤è¯ |
|------|------|------|------|
| POST | `/api/auth/password/change/` | ä¿®æ”¹å¯†ç  | æ˜¯ |
| POST | `/api/auth/password/reset/` | è¯·æ±‚é‡ç½®å¯†ç  | å¦ |
| POST | `/api/auth/password/reset/confirm/` | ç¡®è®¤é‡ç½®å¯†ç  | å¦ |

#### ç”¨æˆ·ä¿¡æ¯

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | è®¤è¯ |
|------|------|------|------|
| GET | `/api/users/me/` | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ | æ˜¯ |
| PUT | `/api/users/me/` | æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯ | æ˜¯ |
| PATCH | `/api/users/me/` | éƒ¨åˆ†æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | æ˜¯ |
| POST | `/api/users/me/avatar/` | ä¸Šä¼ å¤´åƒ | æ˜¯ |
| DELETE | `/api/users/me/` | æ³¨é”€è´¦å· | æ˜¯ |

#### ç®¡ç†æ¥å£ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | è®¤è¯ |
|------|------|------|------|
| GET | `/api/users/` | ç”¨æˆ·åˆ—è¡¨ | Admin |
| GET | `/api/users/{id}/` | ç”¨æˆ·è¯¦æƒ… | Admin |
| PUT | `/api/users/{id}/` | æ›´æ–°ç”¨æˆ· | Admin |
| DELETE | `/api/users/{id}/` | åˆ é™¤ç”¨æˆ· | Admin |
| POST | `/api/users/{id}/activate/` | æ¿€æ´»ç”¨æˆ· | Admin |
| POST | `/api/users/{id}/deactivate/` | ç¦ç”¨ç”¨æˆ· | Admin |

### APIè¯·æ±‚/å“åº”ç¤ºä¾‹

#### 1. ç”¨æˆ·æ³¨å†Œ

**è¯·æ±‚**ï¼š
```json
POST /api/auth/register/
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com",
  "password": "SecurePass123!",
  "password_confirm": "SecurePass123!",
  "phone": "13800138000"  // å¯é€‰
}
```

**å“åº”ï¼ˆæˆåŠŸï¼‰**ï¼š
```json
HTTP 201 Created
Content-Type: application/json

{
  "status": "success",
  "message": "æ³¨å†ŒæˆåŠŸï¼Œè¯·æŸ¥æ”¶é‚®ç®±éªŒè¯é‚®ä»¶",
  "data": {
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "phone": "13800138000",
      "email_verified": false,
      "created_at": "2025-10-21T10:00:00Z"
    },
    "tokens": {
      "access": "eyJ0eXAiOiJKV1QiLCJhbGc...",
      "refresh": "eyJ0eXAiOiJKV1QiLCJhbGc..."
    }
  }
}
```

**å“åº”ï¼ˆå¤±è´¥ï¼‰**ï¼š
```json
HTTP 400 Bad Request
Content-Type: application/json

{
  "status": "error",
  "message": "æ³¨å†Œå¤±è´¥",
  "errors": {
    "email": ["è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ"],
    "password": ["å¯†ç å¼ºåº¦ä¸å¤Ÿ"]
  }
}
```

#### 2. ç”¨æˆ·ç™»å½•

**è¯·æ±‚**ï¼š
```json
POST /api/auth/login/
Content-Type: application/json

{
  "username": "testuser",  // æˆ–ä½¿ç”¨email
  "password": "SecurePass123!"
}
```

**å“åº”**ï¼š
```json
HTTP 200 OK
Content-Type: application/json

{
  "status": "success",
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "avatar": "/media/avatars/user1.jpg"
    },
    "tokens": {
      "access": "eyJ0eXAiOiJKV1QiLCJhbGc...",
      "refresh": "eyJ0eXAiOiJKV1QiLCJhbGc..."
    }
  }
}
```

#### 3. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

**è¯·æ±‚**ï¼š
```http
GET /api/users/me/
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGc...
```

**å“åº”**ï¼š
```json
HTTP 200 OK
Content-Type: application/json

{
  "status": "success",
  "data": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "phone": "13800138000",
    "avatar": "/media/avatars/user1.jpg",
    "bio": "è¿™æ˜¯æˆ‘çš„ä¸ªäººç®€ä»‹",
    "gender": "M",
    "birth_date": "1990-01-01",
    "email_verified": true,
    "phone_verified": false,
    "login_count": 15,
    "created_at": "2025-10-21T10:00:00Z",
    "last_login": "2025-10-21T15:30:00Z"
  }
}
```

## ğŸ¨ ç®¡ç†ç•Œé¢å¢å¼ºæ–¹æ¡ˆ

### 1. Django Adminè‡ªå®šä¹‰

```python
# accounts/admin.py

from django.contrib import admin
from django.contrib.auth.admin import UserAdmin as BaseUserAdmin
from django.contrib.auth.models import User
from .models import UserProfile

class UserProfileInline(admin.StackedInline):
    """å†…è”æ˜¾ç¤ºç”¨æˆ·æ‰©å±•ä¿¡æ¯"""
    model = UserProfile
    can_delete = False
    verbose_name_plural = 'æ‰©å±•ä¿¡æ¯'

class UserAdmin(BaseUserAdmin):
    """å¢å¼ºçš„ç”¨æˆ·ç®¡ç†ç•Œé¢"""
    
    # åˆ—è¡¨é¡µæ˜¾ç¤º
    list_display = [
        'username', 'email', 'phone_display', 
        'is_active', 'email_verified_display',
        'login_count', 'date_joined'
    ]
    
    # åˆ—è¡¨é¡µè¿‡æ»¤å™¨
    list_filter = [
        'is_active', 'is_staff', 'is_superuser',
        'userprofile__email_verified',
        'date_joined'
    ]
    
    # æœç´¢å­—æ®µ
    search_fields = ['username', 'email', 'userprofile__phone']
    
    # å¯ç¼–è¾‘å­—æ®µ
    list_editable = ['is_active']
    
    # æ’åº
    ordering = ['-date_joined']
    
    # å†…è”æ˜¾ç¤ºæ‰©å±•ä¿¡æ¯
    inlines = [UserProfileInline]
    
    # æ‰¹é‡æ“ä½œ
    actions = ['activate_users', 'deactivate_users', 'send_email']
    
    def phone_display(self, obj):
        """æ˜¾ç¤ºæ‰‹æœºå·"""
        return obj.userprofile.phone if hasattr(obj, 'userprofile') else '-'
    phone_display.short_description = 'æ‰‹æœºå·'
    
    def email_verified_display(self, obj):
        """æ˜¾ç¤ºé‚®ç®±éªŒè¯çŠ¶æ€"""
        if hasattr(obj, 'userprofile'):
            return 'âœ…' if obj.userprofile.email_verified else 'âŒ'
        return '-'
    email_verified_display.short_description = 'é‚®ç®±éªŒè¯'
    
    def login_count(self, obj):
        """æ˜¾ç¤ºç™»å½•æ¬¡æ•°"""
        return obj.userprofile.login_count if hasattr(obj, 'userprofile') else 0
    login_count.short_description = 'ç™»å½•æ¬¡æ•°'
    
    def activate_users(self, request, queryset):
        """æ‰¹é‡æ¿€æ´»ç”¨æˆ·"""
        count = queryset.update(is_active=True)
        self.message_user(request, f'å·²æ¿€æ´» {count} ä¸ªç”¨æˆ·')
    activate_users.short_description = 'æ¿€æ´»é€‰ä¸­çš„ç”¨æˆ·'
    
    def deactivate_users(self, request, queryset):
        """æ‰¹é‡ç¦ç”¨ç”¨æˆ·"""
        count = queryset.update(is_active=False)
        self.message_user(request, f'å·²ç¦ç”¨ {count} ä¸ªç”¨æˆ·')
    deactivate_users.short_description = 'ç¦ç”¨é€‰ä¸­çš„ç”¨æˆ·'

# é‡æ–°æ³¨å†ŒUseræ¨¡å‹
admin.site.unregister(User)
admin.site.register(User, UserAdmin)
```

### 2. è‡ªå®šä¹‰ç®¡ç†é¡µé¢

åˆ›å»ºç‹¬ç«‹çš„ç®¡ç†ç•Œé¢ï¼ˆä¸ä½¿ç”¨Django Adminï¼‰ï¼š

**URLè§„åˆ’**ï¼š
```
/admin-panel/
â”œâ”€â”€ /dashboard/           # ä»ªè¡¨ç›˜
â”œâ”€â”€ /users/              # ç”¨æˆ·åˆ—è¡¨
â”œâ”€â”€ /users/<id>/         # ç”¨æˆ·è¯¦æƒ…
â”œâ”€â”€ /users/<id>/edit/    # ç¼–è¾‘ç”¨æˆ·
â”œâ”€â”€ /users/create/       # åˆ›å»ºç”¨æˆ·
â””â”€â”€ /statistics/         # ç»Ÿè®¡æŠ¥è¡¨
```

## ğŸ“ å®æ–½æ­¥éª¤

### é˜¶æ®µ1ï¼šå‡†å¤‡å·¥ä½œï¼ˆ1å¤©ï¼‰

#### 1.1 å®‰è£…ä¾èµ–
```bash
pip install djangorestframework
pip install djangorestframework-simplejwt
pip install django-filter
pip install drf-yasg
pip install pillow  # å›¾ç‰‡å¤„ç†
```

#### 1.2 æ›´æ–°settings.py
```python
INSTALLED_APPS += [
    'rest_framework',
    'rest_framework_simplejwt',
    'django_filters',
    'drf_yasg',
]

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ],
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticatedOrReadOnly',
    ],
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 20,
}

# JWTé…ç½®
from datetime import timedelta
SIMPLE_JWT = {
    'ACCESS_TOKEN_LIFETIME': timedelta(hours=1),
    'REFRESH_TOKEN_LIFETIME': timedelta(days=7),
}
```

### é˜¶æ®µ2ï¼šæ•°æ®æ¨¡å‹æ‰©å±•ï¼ˆ1å¤©ï¼‰

#### 2.1 åˆ›å»ºæ‰©å±•æ¨¡å‹
åˆ›å»º `accounts/models.py` ä¸­çš„ UserProfileã€EmailVerification ç­‰æ¨¡å‹

#### 2.2 æ•°æ®åº“è¿ç§»
```bash
python manage.py makemigrations
python manage.py migrate
```

### é˜¶æ®µ3ï¼šAPIå¼€å‘ï¼ˆ3-4å¤©ï¼‰

#### 3.1 åˆ›å»ºåºåˆ—åŒ–å™¨
```python
# accounts/serializers.py

from rest_framework import serializers
from django.contrib.auth.models import User
from .models import UserProfile

class UserProfileSerializer(serializers.ModelSerializer):
    class Meta:
        model = UserProfile
        fields = ['phone', 'avatar', 'bio', 'gender', 'birth_date']

class UserSerializer(serializers.ModelSerializer):
    profile = UserProfileSerializer(source='userprofile', read_only=True)
    
    class Meta:
        model = User
        fields = ['id', 'username', 'email', 'profile', 'date_joined']
        read_only_fields = ['id', 'date_joined']

class RegisterSerializer(serializers.ModelSerializer):
    password_confirm = serializers.CharField(write_only=True)
    
    class Meta:
        model = User
        fields = ['username', 'email', 'password', 'password_confirm']
        extra_kwargs = {'password': {'write_only': True}}
    
    def validate(self, data):
        if data['password'] != data['password_confirm']:
            raise serializers.ValidationError("å¯†ç ä¸åŒ¹é…")
        return data
    
    def create(self, validated_data):
        validated_data.pop('password_confirm')
        user = User.objects.create_user(**validated_data)
        UserProfile.objects.create(user=user)
        return user
```

#### 3.2 åˆ›å»ºè§†å›¾é›†
```python
# accounts/api_views.py

from rest_framework import viewsets, status
from rest_framework.decorators import action
from rest_framework.response import Response
from rest_framework.permissions import IsAuthenticated, AllowAny
from rest_framework_simplejwt.tokens import RefreshToken

class AuthViewSet(viewsets.GenericViewSet):
    """è®¤è¯ç›¸å…³API"""
    
    @action(detail=False, methods=['post'], permission_classes=[AllowAny])
    def register(self, request):
        """ç”¨æˆ·æ³¨å†Œ"""
        serializer = RegisterSerializer(data=request.data)
        if serializer.is_valid():
            user = serializer.save()
            # ç”ŸæˆToken
            refresh = RefreshToken.for_user(user)
            return Response({
                'status': 'success',
                'message': 'æ³¨å†ŒæˆåŠŸ',
                'data': {
                    'user': UserSerializer(user).data,
                    'tokens': {
                        'access': str(refresh.access_token),
                        'refresh': str(refresh),
                    }
                }
            }, status=status.HTTP_201_CREATED)
        return Response({
            'status': 'error',
            'errors': serializer.errors
        }, status=status.HTTP_400_BAD_REQUEST)
```

#### 3.3 é…ç½®URL
```python
# accounts/api_urls.py

from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .api_views import AuthViewSet, UserViewSet

router = DefaultRouter()
router.register('auth', AuthViewSet, basename='auth')
router.register('users', UserViewSet, basename='users')

urlpatterns = [
    path('', include(router.urls)),
]
```

### é˜¶æ®µ4ï¼šç®¡ç†ç•Œé¢ä¼˜åŒ–ï¼ˆ2å¤©ï¼‰

#### 4.1 å¢å¼ºDjango Admin
å®ç°ä¸Šè¿°çš„UserAdminè‡ªå®šä¹‰

#### 4.2 æ·»åŠ ç»Ÿè®¡åŠŸèƒ½
åˆ›å»ºä»ªè¡¨ç›˜æ˜¾ç¤ºç”¨æˆ·ç»Ÿè®¡æ•°æ®

### é˜¶æ®µ5ï¼šæµ‹è¯•ä¸æ–‡æ¡£ï¼ˆ1-2å¤©ï¼‰

#### 5.1 APIæµ‹è¯•
ä½¿ç”¨Postmanæˆ–pytestç¼–å†™æµ‹è¯•

#### 5.2 APIæ–‡æ¡£
ä½¿ç”¨drf-yasgè‡ªåŠ¨ç”ŸæˆSwaggeræ–‡æ¡£

## ğŸ“Š å·¥ä½œé‡ä¼°ç®—

| é˜¶æ®µ | å·¥ä½œå†…å®¹ | é¢„è®¡æ—¶é—´ |
|------|----------|----------|
| é˜¶æ®µ1 | ç¯å¢ƒå‡†å¤‡ã€ä¾èµ–å®‰è£… | 0.5å¤© |
| é˜¶æ®µ2 | æ•°æ®æ¨¡å‹è®¾è®¡ä¸è¿ç§» | 1å¤© |
| é˜¶æ®µ3 | REST APIå¼€å‘ | 3-4å¤© |
| é˜¶æ®µ4 | ç®¡ç†ç•Œé¢ä¼˜åŒ– | 2å¤© |
| é˜¶æ®µ5 | æµ‹è¯•ä¸æ–‡æ¡£ | 1-2å¤© |
| **æ€»è®¡** | | **7.5-9.5å¤©** |

## ğŸ¯ ä¼˜å…ˆçº§å»ºè®®

### P0ï¼ˆå¿…é¡»ï¼‰
- âœ… ç”¨æˆ·æ³¨å†ŒAPI
- âœ… ç”¨æˆ·ç™»å½•API
- âœ… Tokenè®¤è¯
- âœ… ä¸ªäººä¿¡æ¯è·å–/æ›´æ–°API

### P1ï¼ˆé‡è¦ï¼‰
- â­ UserProfileæ‰©å±•æ¨¡å‹
- â­ å¯†ç ä¿®æ”¹API
- â­ Django Adminå¢å¼º
- â­ APIæ–‡æ¡£

### P2ï¼ˆå¯é€‰ï¼‰
- ğŸ”¸ é‚®ç®±éªŒè¯
- ğŸ”¸ å¯†ç é‡ç½®
- ğŸ”¸ ç¬¬ä¸‰æ–¹ç™»å½•
- ğŸ”¸ ç”¨æˆ·ç»Ÿè®¡æŠ¥è¡¨

## ğŸ“– å­¦ä¹ å»ºè®®

### æ¨èå­¦ä¹ è·¯å¾„

1. **Django REST FrameworkåŸºç¡€**
   - å®˜æ–¹æ•™ç¨‹ï¼šhttps://www.django-rest-framework.org/tutorial/1-serialization/
   - å­¦ä¹ æ—¶é—´ï¼š2-3å¤©

2. **JWTè®¤è¯**
   - Simple JWTæ–‡æ¡£ï¼šhttps://django-rest-framework-simplejwt.readthedocs.io/
   - å­¦ä¹ æ—¶é—´ï¼š1å¤©

3. **Django Adminè‡ªå®šä¹‰**
   - Djangoå®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.djangoproject.com/en/5.2/ref/contrib/admin/
   - å­¦ä¹ æ—¶é—´ï¼š1å¤©

### å®è·µå»ºè®®

1. **ä»ç®€å•å¼€å§‹**ï¼šå…ˆå®ç°åŸºç¡€çš„æ³¨å†Œã€ç™»å½•API
2. **é€æ­¥æ‰©å±•**ï¼šç„¶åæ·»åŠ ä¸ªäººä¿¡æ¯ã€å¯†ç ä¿®æ”¹ç­‰åŠŸèƒ½
3. **æµ‹è¯•é©±åŠ¨**ï¼šæ¯å®Œæˆä¸€ä¸ªAPIå°±è¿›è¡Œæµ‹è¯•
4. **æ–‡æ¡£åŒæ­¥**ï¼šåŠæ—¶æ›´æ–°APIæ–‡æ¡£

## ğŸ” å®‰å…¨æ€§è€ƒè™‘

### å¿…é¡»å®ç°çš„å®‰å…¨æªæ–½

1. **å¯†ç å®‰å…¨**
   - âœ… ä½¿ç”¨Djangoå†…ç½®çš„å¯†ç åŠ å¯†
   - âœ… å¼ºåˆ¶å¯†ç å¼ºåº¦éªŒè¯
   - â­ æ·»åŠ å¯†ç å†å²è®°å½•ï¼ˆé˜²æ­¢é‡å¤ä½¿ç”¨ï¼‰

2. **Tokenå®‰å…¨**
   - âœ… Access TokençŸ­æœŸæœ‰æ•ˆï¼ˆ1å°æ—¶ï¼‰
   - âœ… Refresh Tokené•¿æœŸæœ‰æ•ˆï¼ˆ7å¤©ï¼‰
   - â­ Tokené»‘åå•æœºåˆ¶

3. **é˜²æ­¢æš´åŠ›ç ´è§£**
   - â­ ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶
   - â­ éªŒè¯ç æœºåˆ¶
   - â­ IPé™æµ

4. **æ•°æ®éªŒè¯**
   - âœ… æ‰€æœ‰è¾“å…¥æ•°æ®éªŒè¯
   - âœ… SQLæ³¨å…¥é˜²æŠ¤ï¼ˆORMè‡ªåŠ¨ï¼‰
   - âœ… XSSé˜²æŠ¤ï¼ˆDjangoè‡ªåŠ¨ï¼‰

## ğŸ“‹ æ€»ç»“

æœ¬æ–¹æ¡ˆæä¾›äº†å®Œæ•´çš„ç”¨æˆ·æ¨¡å—REST APIå’Œç®¡ç†ç•Œé¢å¼€å‘è·¯çº¿ï¼š

1. **æŠ€æœ¯é€‰å‹**ï¼šDjango REST Framework + Simple JWT
2. **APIè®¾è®¡**ï¼šRESTfulè§„èŒƒï¼Œå®Œæ•´çš„ç«¯ç‚¹è§„åˆ’
3. **ç®¡ç†ç•Œé¢**ï¼šå¢å¼ºçš„Django Admin + è‡ªå®šä¹‰ç®¡ç†é¡µé¢
4. **å®æ–½æ­¥éª¤**ï¼šåˆ†5ä¸ªé˜¶æ®µï¼Œçº¦8-10å¤©å®Œæˆ
5. **å®‰å…¨æ€§**ï¼šå…¨é¢çš„å®‰å…¨æªæ–½

å»ºè®®**ä¼˜å…ˆå®ç°P0åŠŸèƒ½**ï¼Œç„¶åæ ¹æ®å®é™…éœ€æ±‚é€æ­¥æ‰©å±•ã€‚

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼š
1. Reviewæœ¬æ–¹æ¡ˆï¼Œç¡®è®¤éœ€æ±‚
2. å¼€å§‹é˜¶æ®µ1ï¼šå®‰è£…ä¾èµ–
3. æŒ‰é˜¶æ®µé€æ­¥å®æ–½

æœ‰ä»»ä½•é—®é¢˜éšæ—¶äº¤æµï¼ğŸš€



